import { getRequestPath } from "h3";
import { useChecker, getValidator } from "./validator.mjs";
import config from "#html-validator-config";
export default (function(nitro) {
  const validator = getValidator(config.options);
  const { checkHTML } = useChecker(validator, config.usePrettier, config.logLevel);
  nitro.hooks.hook("render:response", async (response, { event }) => {
    if (typeof response.body === "string" && (response.headers?.["Content-Type"] || response.headers?.["content-type"])?.includes("html")) {
      const promise = checkHTML(getRequestPath(event), response.body);
      if (config.hookable) {
        await nitro.hooks.callHook("html-validator:check", await promise, response, { event });
      }
    }
  });
});
